[gd_resource type="Resource" script_class="NodeScriptResource" load_steps=2 format=3 uid="uid://bncq3jqswv34j"]

[ext_resource type="Script" uid="uid://dj3n2nc47gi02" path="res://addons/nodescript/core/nodescript_resource.gd" id="1_sq03a"]

[resource]
script = ExtResource("1_sq03a")
meta = {
"class_name": "",
"doc": "",
"extends": "EditorPlugin",
"tool": false
}
body = {
"classes": [],
"enums": {},
"functions": [{
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	var confirmation_dialog = ConfirmationDialog.new()",
"type": "raw"
}, {
"text": "	confirmation_dialog.dialog_autowrap = true",
"type": "raw"
}, {
"text": "	confirmation_dialog.title = \"Clear All .nodescript.tres Files\"",
"type": "raw"
}, {
"text": "	confirmation_dialog.ok_button_text = \"Clear All\"",
"type": "raw"
}, {
"text": "	confirmation_dialog.cancel_button_text = \"Cancel\"",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	var label = Label.new()",
"type": "raw"
}, {
"text": "	label.text = \"This will DELETE all .nodescript.tres files in the project.\\n\\nThis action cannot be undone!\\n\\nAre you sure you want to proceed?\"",
"type": "raw"
}, {
"text": "	confirmation_dialog.add_child(label)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	confirmation_dialog.confirmed.connect(_perform_clear_nodescript_files)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	var base_control = get_editor_interface().get_base_control()",
"type": "raw"
}, {
"text": "	if base_control:",
"type": "raw"
}, {
"text": "		base_control.add_child(confirmation_dialog)",
"type": "raw"
}, {
"text": "		confirmation_dialog.popup_centered_ratio(0.4)",
"type": "raw"
}, {
"text": "	else:",
"type": "raw"
}, {
"text": "		push_error(\"NodeScript: Unable to show confirmation dialog (no base control).\")",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 15,
"name": "show_clear_nodescript_files_dialog",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	# Initialization happens in _enable_plugin when the user enables the addon.",
"type": "raw"
}, {
"text": "	pass",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 35,
"name": "_enter_tree",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	_disable_plugin()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 39,
"name": "_exit_tree",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	_setup_docks()",
"type": "raw"
}, {
"text": "	_connect_script_editor()",
"type": "raw"
}, {
"text": "	# Mark ready on the next frame to avoid startup churn",
"type": "raw"
}, {
"text": "	call_deferred(\"_mark_editor_ready\")",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 43,
"name": "_enable_plugin",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	_editor_ready = false",
"type": "raw"
}, {
"text": "	_pending_script_for_autocreate = null",
"type": "raw"
}, {
"text": "	_current_script = null",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	_clear_dock_contents()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	if tree_dock and is_instance_valid(tree_dock):",
"type": "raw"
}, {
"text": "		remove_control_from_docks(tree_dock)",
"type": "raw"
}, {
"text": "		tree_dock.queue_free()",
"type": "raw"
}, {
"text": "		tree_dock = null",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	if script_editor_ref:",
"type": "raw"
}, {
"text": "		if script_editor_ref.editor_script_changed.is_connected(_on_script_changed):",
"type": "raw"
}, {
"text": "			script_editor_ref.editor_script_changed.disconnect(_on_script_changed)",
"type": "raw"
}, {
"text": "		script_editor_ref = null",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 50,
"name": "_disable_plugin",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	_editor_ready = true",
"type": "raw"
}, {
"text": "	if _pending_script_for_autocreate:",
"type": "raw"
}, {
"text": "		call_deferred(\"_attempt_autocreate_if_visible\")",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 67,
"name": "_mark_editor_ready",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	show_clear_nodescript_files_dialog()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 72,
"name": "_on_clear_nodescript_files_pressed",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	var file_system = get_editor_interface().get_resource_filesystem()",
"type": "raw"
}, {
"text": "	var deleted_files = []",
"type": "raw"
}, {
"text": "	_delete_nodescript_files_recursive(\"res://\", deleted_files)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Refresh file system",
"type": "raw"
}, {
"text": "	if file_system:",
"type": "raw"
}, {
"text": "		file_system.scan()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	if deleted_files.is_empty():",
"type": "raw"
}, {
"text": "		push_warning(\"NodeScript: No .nodescript.tres files found to delete.\")",
"type": "raw"
}, {
"text": "	else:",
"type": "raw"
}, {
"text": "		push_warning(\"NodeScript: Cleared %d .nodescript.tres file(s).\" % deleted_files.size())",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 75,
"name": "_perform_clear_nodescript_files",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	var dir = DirAccess.open(path)",
"type": "raw"
}, {
"text": "	if not dir:",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	dir.list_dir_begin()",
"type": "raw"
}, {
"text": "	var file_name = dir.get_next()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	while file_name != \"\":",
"type": "raw"
}, {
"text": "		if file_name.begins_with(\".\"):",
"type": "raw"
}, {
"text": "			file_name = dir.get_next()",
"type": "raw"
}, {
"text": "			continue",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "		var full_path = path.path_join(file_name)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "		if dir.current_is_dir():",
"type": "raw"
}, {
"text": "			_delete_nodescript_files_recursive(full_path, deleted_files)",
"type": "raw"
}, {
"text": "		elif file_name.ends_with(\".nodescript.tres\"):",
"type": "raw"
}, {
"text": "			var err = DirAccess.remove_absolute(full_path)",
"type": "raw"
}, {
"text": "			if err == OK:",
"type": "raw"
}, {
"text": "				deleted_files.append(full_path)",
"type": "raw"
}, {
"text": "			else:",
"type": "raw"
}, {
"text": "				push_error(\"NodeScript: Failed to delete %s (error %d)\" % [full_path, err])",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "		file_name = dir.get_next()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 89,
"name": "_delete_nodescript_files_recursive",
"parameters": [{
"default": "",
"name": "path",
"type": "String"
}, {
"default": "",
"name": "deleted_files",
"type": "Array"
}],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	# Label of the main tab",
"type": "raw"
}, {
"text": "	return \"NodeScript\"",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 115,
"name": "_get_plugin_name",
"parameters": [],
"region": "",
"return_type": "String",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	# Use built-in Script icon for now",
"type": "raw"
}, {
"text": "	return get_editor_interface().get_editor_theme().get_icon(\"Script\", \"EditorIcons\")",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 119,
"name": "_get_plugin_icon",
"parameters": [],
"region": "",
"return_type": "Texture2D",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	# Remember current focused control to avoid stealing focus when adding docks",
"type": "raw"
}, {
"text": "	var prev_focus: Control = null",
"type": "raw"
}, {
"text": "	var base := get_editor_interface().get_base_control()",
"type": "raw"
}, {
"text": "	if base and base.get_viewport():",
"type": "raw"
}, {
"text": "		prev_focus = base.get_viewport().gui_get_focus_owner()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Create tree dock for left sidebar",
"type": "raw"
}, {
"text": "	tree_dock = Control.new()",
"type": "raw"
}, {
"text": "	tree_dock.tooltip_text = \"NodeScript\"",
"type": "raw"
}, {
"text": "	tree_dock.size_flags_horizontal = Control.SIZE_EXPAND_FILL",
"type": "raw"
}, {
"text": "	tree_dock.size_flags_vertical = Control.SIZE_EXPAND_FILL",
"type": "raw"
}, {
"text": "	var tree_dock_content = NodeScriptTreeDockScript.new()",
"type": "raw"
}, {
"text": "	tree_dock_content.name = \"NodeScriptTreeDockContent\"",
"type": "raw"
}, {
"text": "	tree_dock_content.set_editor_plugin(self)",
"type": "raw"
}, {
"text": "	tree_dock_content.size_flags_horizontal = Control.SIZE_EXPAND_FILL",
"type": "raw"
}, {
"text": "	tree_dock_content.size_flags_vertical = Control.SIZE_EXPAND_FILL",
"type": "raw"
}, {
"text": "	tree_dock_content.anchor_right = 1.0",
"type": "raw"
}, {
"text": "	tree_dock_content.anchor_bottom = 1.0",
"type": "raw"
}, {
"text": "	tree_dock.add_child(tree_dock_content)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Add to left dock (top area near Scene tree)",
"type": "raw"
}, {
"text": "	add_control_to_dock(DOCK_SLOT_LEFT_UR, tree_dock)",
"type": "raw"
}, {
"text": "	_set_dock_tab_icon_from_list(tree_dock, [\"Tree\", \"Filesystem\", \"Folder\"])",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Keep docks present even before a NodeScript exists",
"type": "raw"
}, {
"text": "	tree_dock.visible = true",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Restore previous focus so docks don't steal it (deferred to let dock creation finish)",
"type": "raw"
}, {
"text": "	if prev_focus and is_instance_valid(prev_focus):",
"type": "raw"
}, {
"text": "		call_deferred(\"_deferred_restore_focus\", prev_focus)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# React when a dock tab becomes visible to trigger auto-create if needed",
"type": "raw"
}, {
"text": "	tree_dock.visibility_changed.connect(_on_dock_visibility_changed)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 124,
"name": "_setup_docks",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if control and is_instance_valid(control):",
"type": "raw"
}, {
"text": "		control.grab_focus()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 159,
"name": "_deferred_restore_focus",
"parameters": [{
"default": "",
"name": "control",
"type": "Control"
}],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if not control:",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "	var theme = get_editor_interface().get_editor_theme()",
"type": "raw"
}, {
"text": "	if not theme:",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "	for name in icon_names:",
"type": "raw"
}, {
"text": "		if theme.has_icon(name, \"EditorIcons\"):",
"type": "raw"
}, {
"text": "			set_dock_tab_icon(control, theme.get_icon(name, \"EditorIcons\"))",
"type": "raw"
}, {
"text": "			return",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 163,
"name": "_set_dock_tab_icon_from_list",
"parameters": [{
"default": "",
"name": "control",
"type": "Control"
}, {
"default": "",
"name": "icon_names",
"type": "Array"
}],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if not control:",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "	if not custom_path.is_empty() and ResourceLoader.exists(custom_path):",
"type": "raw"
}, {
"text": "		var tex = load(custom_path)",
"type": "raw"
}, {
"text": "		if tex:",
"type": "raw"
}, {
"text": "			set_dock_tab_icon(control, tex)",
"type": "raw"
}, {
"text": "			return",
"type": "raw"
}, {
"text": "	_set_dock_tab_icon_from_list(control, fallback_icons)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 174,
"name": "_set_dock_tab_icon_custom_or_list",
"parameters": [{
"default": "",
"name": "control",
"type": "Control"
}, {
"default": "",
"name": "custom_path",
"type": "String"
}, {
"default": "",
"name": "fallback_icons",
"type": "Array"
}],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	script_editor_ref = get_editor_interface().get_script_editor()",
"type": "raw"
}, {
"text": "	if script_editor_ref:",
"type": "raw"
}, {
"text": "		script_editor_ref.editor_script_changed.connect(_on_script_changed)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "		# Load current script if any",
"type": "raw"
}, {
"text": "		var current_script = script_editor_ref.get_current_script()",
"type": "raw"
}, {
"text": "		if current_script:",
"type": "raw"
}, {
"text": "			_on_script_changed(current_script)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 184,
"name": "_connect_script_editor",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if not script:",
"type": "raw"
}, {
"text": "		_current_script = null",
"type": "raw"
}, {
"text": "		_pending_script_for_autocreate = null",
"type": "raw"
}, {
"text": "		_clear_dock_contents()",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "	",
"type": "raw"
}, {
"text": "	# Skip if script file doesn't exist on disk",
"type": "raw"
}, {
"text": "	if not FileAccess.file_exists(script.resource_path):",
"type": "raw"
}, {
"text": "		_current_script = null",
"type": "raw"
}, {
"text": "		_pending_script_for_autocreate = null",
"type": "raw"
}, {
"text": "		_clear_dock_contents()",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	_current_script = script",
"type": "raw"
}, {
"text": "	",
"type": "raw"
}, {
"text": "	# Uncomment for debugging",
"type": "raw"
}, {
"text": "	#if _editor_ready:",
"type": "raw"
}, {
"text": "	#	print(\"NodeScript: Script changed to %s\" % script.resource_path)",
"type": "raw"
}, {
"text": "	",
"type": "raw"
}, {
"text": "	# Check if this script has a NodeScript resource",
"type": "raw"
}, {
"text": "	var ns_path = _get_nodescript_path(script)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	if not ns_path.is_empty():",
"type": "raw"
}, {
"text": "		# Uncomment for debugging",
"type": "raw"
}, {
"text": "		#if _editor_ready:",
"type": "raw"
}, {
"text": "		#	print(\"NodeScript: Found existing resource at %s\" % ns_path)",
"type": "raw"
}, {
"text": "		_pending_script_for_autocreate = null",
"type": "raw"
}, {
"text": "		_load_script_in_docks(script)",
"type": "raw"
}, {
"text": "	else:",
"type": "raw"
}, {
"text": "		# Only auto-create after editor is ready (avoid startup churn)",
"type": "raw"
}, {
"text": "		_pending_script_for_autocreate = script",
"type": "raw"
}, {
"text": "		if _editor_ready:",
"type": "raw"
}, {
"text": "			call_deferred(\"_deferred_autocreate_nodescript\", script)",
"type": "raw"
}, {
"text": "		else:",
"type": "raw"
}, {
"text": "			_clear_dock_contents()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 196,
"name": "_on_script_changed",
"parameters": [{
"default": "",
"name": "script",
"type": "Script"
}],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if not script:",
"type": "raw"
}, {
"text": "		return \"\"",
"type": "raw"
}, {
"text": "	# Typical naming used in examples: res://path/player.nodescript.tres",
"type": "raw"
}, {
"text": "	var base = script.resource_path.get_basename()",
"type": "raw"
}, {
"text": "	var candidate_basename = base + \".nodescript.tres\"",
"type": "raw"
}, {
"text": "	if ResourceLoader.exists(candidate_basename):",
"type": "raw"
}, {
"text": "		return candidate_basename",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Fallback to older scheme (script.gd.nodescript.tres)",
"type": "raw"
}, {
"text": "	var candidate_suffix = script.resource_path + \".nodescript.tres\"",
"type": "raw"
}, {
"text": "	if ResourceLoader.exists(candidate_suffix):",
"type": "raw"
}, {
"text": "		return candidate_suffix",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	return \"\"",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 233,
"name": "_get_nodescript_path",
"parameters": [{
"default": "",
"name": "script",
"type": "Script"
}],
"region": "",
"return_type": "String",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	# Uncomment for debugging",
"type": "raw"
}, {
"text": "	#print(\"NodeScript: Loading script in docks: %s\" % script.resource_path)",
"type": "raw"
}, {
"text": "	# Load script in tree dock",
"type": "raw"
}, {
"text": "	if tree_dock:",
"type": "raw"
}, {
"text": "		var tree_content = tree_dock.get_node_or_null(\"NodeScriptTreeDockContent\")",
"type": "raw"
}, {
"text": "		if tree_content and tree_content.has_method(\"load_script\"):",
"type": "raw"
}, {
"text": "			# Uncomment for debugging",
"type": "raw"
}, {
"text": "			#print(\"NodeScript: Loading in tree dock\")",
"type": "raw"
}, {
"text": "			tree_content.load_script(script)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 249,
"name": "_load_script_in_docks",
"parameters": [{
"default": "",
"name": "script",
"type": "Script"
}],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if tree_dock:",
"type": "raw"
}, {
"text": "		var tree_content = tree_dock.get_node_or_null(\"NodeScriptTreeDockContent\")",
"type": "raw"
}, {
"text": "		if tree_content:",
"type": "raw"
}, {
"text": "			if tree_content.has_method(\"clear_tree\"):",
"type": "raw"
}, {
"text": "				tree_content.clear_tree()",
"type": "raw"
}, {
"text": "			elif tree_content.has_method(\"load_script\"):",
"type": "raw"
}, {
"text": "				tree_content.load_script(null)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 260,
"name": "_clear_dock_contents",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if not _pending_script_for_autocreate:",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "	# Only auto-create when the dock becomes visible (selected/tabbed)",
"type": "raw"
}, {
"text": "	_attempt_autocreate_if_visible()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 269,
"name": "_on_dock_visibility_changed",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if not _pending_script_for_autocreate:",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "	if (tree_dock and tree_dock.visible):",
"type": "raw"
}, {
"text": "		var created_path = _ensure_nodescript_resource(_pending_script_for_autocreate)",
"type": "raw"
}, {
"text": "		if not created_path.is_empty():",
"type": "raw"
}, {
"text": "			_pending_script_for_autocreate = null",
"type": "raw"
}, {
"text": "			_load_script_in_docks(_current_script)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 275,
"name": "_attempt_autocreate_if_visible",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	# Only create if script is valid (don't check if it's still current - allows batch creation during startup)",
"type": "raw"
}, {
"text": "	if not script:",
"type": "raw"
}, {
"text": "		return",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	var created_path = _ensure_nodescript_resource(script)",
"type": "raw"
}, {
"text": "	if not created_path.is_empty():",
"type": "raw"
}, {
"text": "		# If this script is still the current one, load it in docks",
"type": "raw"
}, {
"text": "		if script == _current_script:",
"type": "raw"
}, {
"text": "			_pending_script_for_autocreate = null",
"type": "raw"
}, {
"text": "			# Give filesystem a moment to sync before loading",
"type": "raw"
}, {
"text": "			call_deferred(\"_load_script_in_docks\", script)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 284,
"name": "_deferred_autocreate_nodescript",
"parameters": [{
"default": "",
"name": "script",
"type": "Script"
}],
"region": "",
"return_type": "void",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if not script:",
"type": "raw"
}, {
"text": "		return \"\"",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	var ns_path = _get_nodescript_path(script)",
"type": "raw"
}, {
"text": "	if not ns_path.is_empty():",
"type": "raw"
}, {
"text": "		return ns_path",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Create a new NodeScript resource beside the script",
"type": "raw"
}, {
"text": "	var base = script.resource_path.get_basename()",
"type": "raw"
}, {
"text": "	var target_path = base + \".nodescript.tres\"",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	var sync = NodeScriptSync.new()",
"type": "raw"
}, {
"text": "	var res = NodeScriptResource.new()",
"type": "raw"
}, {
"text": "	sync.nodescript = res",
"type": "raw"
}, {
"text": "	sync._ensure_body_structure()",
"type": "raw"
}, {
"text": "	# Parse the existing script to populate the resource",
"type": "raw"
}, {
"text": "	sync._sync_from_script_source(script)",
"type": "raw"
}, {
"text": "	res = sync.nodescript",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	var err = ResourceSaver.save(res, target_path)",
"type": "raw"
}, {
"text": "	if err != OK:",
"type": "raw"
}, {
"text": "		push_error(\"NodeScript: Failed to auto-create %s (error %d)\" % [target_path, err])",
"type": "raw"
}, {
"text": "		return \"\"",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Force file system scan to register the new file",
"type": "raw"
}, {
"text": "	var file_system = get_editor_interface().get_resource_filesystem()",
"type": "raw"
}, {
"text": "	if file_system:",
"type": "raw"
}, {
"text": "		file_system.scan()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	# Ensure ResourceLoader sees the new file without stale cache",
"type": "raw"
}, {
"text": "	var _tmp = ResourceLoader.load(target_path, \"\", ResourceLoader.CACHE_MODE_REPLACE)",
"type": "raw"
}, {
"text": "",
"type": "raw"
}, {
"text": "	return target_path",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 297,
"name": "_ensure_nodescript_resource",
"parameters": [{
"default": "",
"name": "script",
"type": "Script"
}],
"region": "",
"return_type": "String",
"scope_line": 0
}, {
"body": [{
"text": "NodeScript: default method body",
"type": "comment"
}, {
"text": "pass",
"type": "pass"
}, {
"text": "	if tree_dock:",
"type": "raw"
}, {
"text": "		var tree_content = tree_dock.get_node_or_null(\"NodeScriptTreeDockContent\")",
"type": "raw"
}, {
"text": "		if tree_content and tree_content.has_method(\"_build_tree\"):",
"type": "raw"
}, {
"text": "			tree_content._build_tree()",
"type": "raw"
}, {
"text": "",
"type": "raw"
}],
"class": "",
"def_line": 332,
"name": "_refresh_tree_dock",
"parameters": [],
"region": "",
"return_type": "void",
"scope_line": 0
}],
"order": {
"|": [{
"code": "const NodeScriptTreeDockScript: Script = preload(\"res://addons/nodescript/editor/nodescript_tree_dock.gd\")",
"indent": 0,
"line": 4,
"name": "NodeScriptTreeDockScript",
"type": "variable"
}, {
"code": "const NodeScriptResource = preload(\"res://addons/nodescript/core/nodescript_resource.gd\")",
"indent": 0,
"line": 5,
"name": "NodeScriptResource = preload(\"res",
"type": "variable"
}, {
"code": "const NodeScriptSync = preload(\"res://addons/nodescript/editor/nodescript_sync.gd\")",
"indent": 0,
"line": 6,
"name": "NodeScriptSync = preload(\"res",
"type": "variable"
}, {
"auto_spacing": false,
"count": 1,
"indent": 0,
"line": 7,
"manual_blank": true,
"name": "blank_1",
"type": "blank"
}, {
"code": "var tree_dock: Control",
"indent": 0,
"line": 8,
"name": "tree_dock",
"type": "variable"
}, {
"code": "var script_editor_ref: ScriptEditor",
"indent": 0,
"line": 9,
"name": "script_editor_ref",
"type": "variable"
}, {
"code": "var _current_script: Script",
"indent": 0,
"line": 10,
"name": "_current_script",
"type": "variable"
}, {
"code": "var _pending_script_for_autocreate: Script",
"indent": 0,
"line": 11,
"name": "_pending_script_for_autocreate",
"type": "variable"
}, {
"code": "var _editor_ready: bool = false",
"indent": 0,
"line": 12,
"name": "_editor_ready",
"type": "variable"
}, {
"code": "var _ready_frame_count: int = 0",
"indent": 0,
"line": 13,
"name": "_ready_frame_count",
"type": "variable"
}, {
"auto_spacing": false,
"count": 1,
"indent": 0,
"line": 14,
"manual_blank": true,
"name": "blank_2",
"type": "blank"
}, {
"code": "func show_clear_nodescript_files_dialog() -> void:",
"indent": 0,
"line": 15,
"name": "show_clear_nodescript_files_dialog",
"type": "function"
}, {
"code": "func _enter_tree() -> void:",
"indent": 0,
"line": 35,
"name": "_enter_tree",
"type": "function"
}, {
"code": "func _exit_tree() -> void:",
"indent": 0,
"line": 39,
"name": "_exit_tree",
"type": "function"
}, {
"code": "func _enable_plugin() -> void:",
"indent": 0,
"line": 43,
"name": "_enable_plugin",
"type": "function"
}, {
"code": "func _disable_plugin() -> void:",
"indent": 0,
"line": 50,
"name": "_disable_plugin",
"type": "function"
}, {
"code": "func _mark_editor_ready() -> void:",
"indent": 0,
"line": 67,
"name": "_mark_editor_ready",
"type": "function"
}, {
"code": "func _on_clear_nodescript_files_pressed() -> void:",
"indent": 0,
"line": 72,
"name": "_on_clear_nodescript_files_pressed",
"type": "function"
}, {
"code": "func _perform_clear_nodescript_files() -> void:",
"indent": 0,
"line": 75,
"name": "_perform_clear_nodescript_files",
"type": "function"
}, {
"code": "func _delete_nodescript_files_recursive(path: String, deleted_files: Array) -> void:",
"indent": 0,
"line": 89,
"name": "_delete_nodescript_files_recursive",
"type": "function"
}, {
"code": "func _get_plugin_name() -> String:",
"indent": 0,
"line": 115,
"name": "_get_plugin_name",
"type": "function"
}, {
"code": "func _get_plugin_icon() -> Texture2D:",
"indent": 0,
"line": 119,
"name": "_get_plugin_icon",
"type": "function"
}, {
"code": "func _setup_docks() -> void:",
"indent": 0,
"line": 124,
"name": "_setup_docks",
"type": "function"
}, {
"code": "func _deferred_restore_focus(control: Control) -> void:",
"indent": 0,
"line": 159,
"name": "_deferred_restore_focus",
"type": "function"
}, {
"code": "func _set_dock_tab_icon_from_list(control: Control, icon_names: Array) -> void:",
"indent": 0,
"line": 163,
"name": "_set_dock_tab_icon_from_list",
"type": "function"
}, {
"code": "func _set_dock_tab_icon_custom_or_list(control: Control, custom_path: String, fallback_icons: Array) -> void:",
"indent": 0,
"line": 174,
"name": "_set_dock_tab_icon_custom_or_list",
"type": "function"
}, {
"code": "func _connect_script_editor() -> void:",
"indent": 0,
"line": 184,
"name": "_connect_script_editor",
"type": "function"
}, {
"code": "func _on_script_changed(script: Script) -> void:",
"indent": 0,
"line": 196,
"name": "_on_script_changed",
"type": "function"
}, {
"code": "func _get_nodescript_path(script: Script) -> String:",
"indent": 0,
"line": 233,
"name": "_get_nodescript_path",
"type": "function"
}, {
"code": "func _load_script_in_docks(script: Script) -> void:",
"indent": 0,
"line": 249,
"name": "_load_script_in_docks",
"type": "function"
}, {
"code": "func _clear_dock_contents() -> void:",
"indent": 0,
"line": 260,
"name": "_clear_dock_contents",
"type": "function"
}, {
"code": "func _on_dock_visibility_changed() -> void:",
"indent": 0,
"line": 269,
"name": "_on_dock_visibility_changed",
"type": "function"
}, {
"code": "func _attempt_autocreate_if_visible() -> void:",
"indent": 0,
"line": 275,
"name": "_attempt_autocreate_if_visible",
"type": "function"
}, {
"code": "func _deferred_autocreate_nodescript(script: Script) -> void:",
"indent": 0,
"line": 284,
"name": "_deferred_autocreate_nodescript",
"type": "function"
}, {
"code": "func _ensure_nodescript_resource(script: Script) -> String:",
"indent": 0,
"line": 297,
"name": "_ensure_nodescript_resource",
"type": "function"
}, {
"code": "func _refresh_tree_dock() -> void:",
"indent": 0,
"line": 332,
"name": "_refresh_tree_dock",
"type": "function"
}]
},
"regions": [],
"signals": {},
"variables": [{
"class": "",
"const": true,
"export": false,
"name": "NodeScriptTreeDockScript",
"onready": false,
"region": "",
"scope_line": 0,
"type": "Script",
"value": "preload(\"res"
}, {
"class": "",
"const": true,
"export": false,
"name": "NodeScriptResource = preload(\"res",
"onready": false,
"region": "",
"scope_line": 0,
"type": "//addons/nodescript/core/nodescript_resource.gd\")",
"value": ""
}, {
"class": "",
"const": true,
"export": false,
"name": "NodeScriptSync = preload(\"res",
"onready": false,
"region": "",
"scope_line": 0,
"type": "//addons/nodescript/editor/nodescript_sync.gd\")",
"value": ""
}, {
"class": "",
"const": false,
"export": false,
"name": "tree_dock",
"onready": false,
"region": "",
"scope_line": 0,
"type": "Control",
"value": ""
}, {
"class": "",
"const": false,
"export": false,
"name": "script_editor_ref",
"onready": false,
"region": "",
"scope_line": 0,
"type": "ScriptEditor",
"value": ""
}, {
"class": "",
"const": false,
"export": false,
"name": "_current_script",
"onready": false,
"region": "",
"scope_line": 0,
"type": "Script",
"value": ""
}, {
"class": "",
"const": false,
"export": false,
"name": "_pending_script_for_autocreate",
"onready": false,
"region": "",
"scope_line": 0,
"type": "Script",
"value": ""
}, {
"class": "",
"const": false,
"export": false,
"name": "_editor_ready",
"onready": false,
"region": "",
"scope_line": 0,
"type": "bool",
"value": "false"
}, {
"class": "",
"const": false,
"export": false,
"name": "_ready_frame_count",
"onready": false,
"region": "",
"scope_line": 0,
"type": "int",
"value": "0"
}]
}
